<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard | Orders</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f7f7f7; padding:20px; }
    h2 { color:#333; }
    .order { background:#fff; border-radius:10px; padding:15px; margin:10px 0; box-shadow:0 0 5px #ccc; }
    .order h3 { margin:0; }
    .order small { color:gray; }
    button { margin:5px; padding:5px 10px; border:none; border-radius:6px; cursor:pointer; }
    .pending { background:#ffb347; }
    .preparing { background:#4fa3ff; color:#fff; }
    .completed { background:#4CAF50; color:#fff; }
    .clear { background:#e74c3c; color:white; padding:8px 16px; }
  </style>
</head>
<body>
  <h2>ðŸ“‹ Live Orders</h2>
  <button id="clearAll" class="clear">Clear All Orders</button>
  <div id="orders"></div>

  <script>
    async function loadOrders() {
      const res = await fetch('/admin/orders');
      const orders = await res.json();
      const container = document.getElementById('orders');
      container.innerHTML = '';

      if (orders.length === 0) {
        container.innerHTML = '<p>No orders yet ðŸ’¤</p>';
        return;
      }

      orders.forEach(order => {
        
        const div = document.createElement('div');
        div.className = 'order';
        div.innerHTML = `
          <h3>ðŸª‘ Table ${order.table} â€” <small>${order.time}</small></h3>
          <p><strong>Order ID:</strong> ${order.id}</p>
          <ul>
            ${order.items.map(i => `<li>${i.name} Ã— ${i.qty} â€” â‚¹${i.price * i.qty}</li>`).join('')}
          </ul>
          <strong>Status:</strong> ${order.status}
          
          <div>
            <button onclick="updateStatus('${order.id}', 'Preparing')" class="preparing">Preparing</button>
            <button onclick="updateStatus('${order.id}', 'Completed')" class="completed">Completed</button>
          </div>
        `;
        
        container.appendChild(div);
      });
    }

    async function updateStatus(id, status) {
      await fetch('/admin/update', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, status })
      });
      loadOrders();
    }

    document.getElementById('clearAll').addEventListener('click', async () => {
      if (!confirm('Clear all orders?')) return;
      await fetch('/admin/clear', { method: 'POST' });
      loadOrders();
    });

    setInterval(loadOrders, 3000);
    loadOrders();
  </script>
</body>
</html>